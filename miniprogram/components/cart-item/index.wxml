<!--components/cart-item/index.wxml-->
<view 
  class="cart-item {{selected ? 'selected' : ''}} {{editMode ? 'edit-mode' : ''}} {{disabled ? 'disabled' : ''}} {{stockStatus}}"
  data-product-id="{{item.productId}}"
  animation="{{deleteAnimation}}"
  bindlongpress="onLongPress"
>
  <!-- ÈÄâÊã©Ê°Ü -->
  <view class="select-container" bindtap="onSelectToggle" animation="{{selectAnimation}}">
    <view class="select-checkbox {{selected ? 'checked' : ''}}">
      <text wx:if="{{selected}}" class="check-icon">‚úì</text>
    </view>
  </view>

  <!-- ÂïÜÂìÅ‰ø°ÊÅØÂå∫Âüü -->
  <view class="product-info" bindtap="onProductTap">
    <!-- ÂïÜÂìÅÂõæÁâá -->
    <view class="product-image-container">
      <image 
        class="product-image {{imageLoading ? 'loading' : ''}}" 
        src="{{item.product.image}}" 
        mode="aspectFill"
        lazy-load="{{true}}"
        bindload="onImageLoad"
        binderror="onImageError"
        show-menu-by-longpress="{{false}}"
      />
      
      <!-- ÂõæÁâáÂä†ËΩΩÂç†‰ΩçÁ¨¶ -->
      <view wx:if="{{imageLoading}}" class="image-placeholder">
        <view class="placeholder-icon">
          <text class="icon-image">üì∑</text>
        </view>
      </view>
      
      <!-- ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•Âç†‰ΩçÁ¨¶ -->
      <view wx:if="{{imageError}}" class="image-error" bindtap="retryImageLoad">
        <view class="error-icon">
          <text class="icon-error">üñºÔ∏è</text>
        </view>
        <text class="error-text">ÈáçÊñ∞Âä†ËΩΩ</text>
      </view>
      
      <!-- Â∫ìÂ≠òÁä∂ÊÄÅË¶ÜÁõñÂ±Ç -->
      <view wx:if="{{stockStatus === 'out'}}" class="stock-overlay">
        <text class="stock-overlay-text">Áº∫Ë¥ß</text>
      </view>
    </view>

    <!-- ÂïÜÂìÅËØ¶ÊÉÖ -->
    <view class="product-details">
      <!-- ÂïÜÂìÅÂêçÁß∞ -->
      <text class="product-name">{{item.product.name}}</text>
      
      <!-- ÂïÜÂìÅÊèèËø∞ -->
      <text wx:if="{{item.product.description}}" class="product-description">{{item.product.description}}</text>
      
      <!-- ‰øÉÈîÄÊ†áÁ≠æ -->
      <view wx:if="{{promotionTags.length > 0}}" class="promotion-tags">
        <text 
          wx:for="{{promotionTags}}" 
          wx:key="*this" 
          class="promotion-tag {{item === '7Â§©Êó†ÁêÜÁî±ÈÄÄË¥ß' ? 'return-tag' : ''}} {{item === 'Â∫ìÂ≠òÁ¥ßÂº†' ? 'stock-tag' : ''}}"
        >
          {{item}}
        </text>
      </view>
      
      <!-- ‰ª∑Ê†º‰ø°ÊÅØ -->
      <view class="price-container">
        <!-- ÊäòÊâ£‰ª∑Ê†º -->
        <text wx:if="{{hasDiscount()}}" class="discounted-price">
          {{getDisplayPrice()}}
        </text>
        
        <!-- Âéü‰ª∑ -->
        <text class="original-price {{hasDiscount() ? 'crossed-out' : ''}}">
          {{hasDiscount() ? getOriginalPrice() : getDisplayPrice()}}
        </text>
      </view>
      
      <!-- Â∫ìÂ≠òÁä∂ÊÄÅ -->
      <view class="stock-info">
        <text class="stock-text {{stockStatus === 'low' ? 'low-stock' : ''}} {{stockStatus === 'out' ? 'out-stock' : ''}}">
          {{getStockStatusText()}}
        </text>
      </view>
    </view>
  </view>

  <!-- Êìç‰ΩúÂå∫Âüü -->
  <view class="actions-container">
    <!-- ÁºñËæëÊ®°Âºè‰∏ãÁöÑÂà†Èô§ÊåâÈíÆ -->
    <view wx:if="{{editMode}}" class="edit-actions">
      <button 
        class="delete-btn"
        bindtap="onDeleteTap"
        disabled="{{disabled}}"
        hover-class="btn-hover"
        hover-stay-time="100"
      >
        <text class="delete-icon">üóëÔ∏è</text>
      </button>
    </view>
    
    <!-- Êï∞ÈáèÈÄâÊã©Âô® -->
    <view wx:else class="quantity-container">
      <quantity-selector
        quantity="{{item.quantity}}"
        maxQuantity="{{item.product.stock}}"
        minQuantity="{{1}}"
        disabled="{{!canAdjustQuantity()}}"
        size="small"
        bindchange="onQuantityChange"
      />
    </view>
    
    <!-- Â∞èËÆ°ÈáëÈ¢ù -->
    <view class="subtotal-container">
      <text class="subtotal-label">Â∞èËÆ°</text>
      <text class="subtotal-price">{{getSubtotal()}}</text>
    </view>
  </view>

  <!-- ÊªëÂä®Âà†Èô§ÊèêÁ§∫ -->
  <view wx:if="{{!editMode}}" class="swipe-hint">
    <text class="hint-text">‚Üê Â∑¶ÊªëÂà†Èô§</text>
  </view>
</view>