<!--components/product-card/index.wxml-->
<view class="product-card" bindtap="onProductTap" bindlongpress="onProductLongPress" data-product-id="{{product.id}}">
  <!-- äº§å“å›¾ç‰‡åŒºåŸŸ -->
  <view class="product-image-container">
    <image 
      class="product-image {{imageLoading ? 'loading' : ''}}" 
      src="{{product.image}}" 
      mode="aspectFill"
      lazy-load="{{true}}"
      bindload="onImageLoad"
      binderror="onImageError"
      show-menu-by-longpress="{{false}}"
    />
    
    <!-- å›¾ç‰‡åŠ è½½å ä½ç¬¦ -->
    <view wx:if="{{imageLoading}}" class="image-placeholder">
      <view class="placeholder-icon">
        <text class="icon-image">ğŸ“·</text>
      </view>
      <text class="placeholder-text">åŠ è½½ä¸­...</text>
    </view>
    
    <!-- å›¾ç‰‡åŠ è½½å¤±è´¥å ä½ç¬¦ -->
    <view wx:if="{{imageError}}" class="image-error">
      <view class="error-icon">
        <text class="icon-error">ğŸ–¼ï¸</text>
      </view>
      <text class="error-text">å›¾ç‰‡åŠ è½½å¤±è´¥</text>
    </view>
    
    <!-- äº§å“æ ‡ç­¾ -->
    <view wx:if="{{product.tags && product.tags.length > 0}}" class="product-tags">
      <text 
        wx:for="{{product.tags}}" 
        wx:key="*this" 
        class="product-tag"
      >
        {{item}}
      </text>
    </view>
  </view>
  
  <!-- äº§å“ä¿¡æ¯åŒºåŸŸ -->
  <view class="product-info">
    <!-- äº§å“åç§° -->
    <text class="product-name">{{product.name}}</text>
    
    <!-- äº§å“æè¿° -->
    <text wx:if="{{product.description}}" class="product-description">{{product.description}}</text>
    
    <!-- ä»·æ ¼åŒºåŸŸ -->
    <view class="price-container">
      <!-- æŠ˜æ‰£ä»·æ ¼ -->
      <text wx:if="{{product.discountedPrice}}" class="discounted-price">
        Â¥{{product.discountedPrice}}
      </text>
      
      <!-- åŸä»· -->
      <text class="original-price {{product.discountedPrice ? 'crossed-out' : ''}}">
        Â¥{{product.originalPrice}}
      </text>
      
      <!-- æŠ˜æ‰£æ ‡ç­¾ -->
      <view wx:if="{{discountPercentage > 0}}" class="discount-badge">
        <text class="discount-text">{{discountPercentage}}æŠ˜</text>
      </view>
    </view>
    
    <!-- åº“å­˜ä¿¡æ¯ -->
    <view class="stock-info">
      <text class="stock-text {{product.stock <= 5 ? 'low-stock' : ''}}">
        {{product.stock > 0 ? 'åº“å­˜ï¼š' + product.stock : 'æš‚æ— åº“å­˜'}}
      </text>
    </view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
  <view class="product-actions">
    <!-- æ·»åŠ åˆ°è´­ç‰©è½¦æŒ‰é’® -->
    <button 
      class="add-to-cart-btn {{product.stock <= 0 ? 'disabled' : ''}} {{addingToCart ? 'loading' : ''}}"
      disabled="{{product.stock <= 0 || addingToCart}}"
      bindtap="onAddToCart"
      data-product-id="{{product.id}}"
      hover-class="btn-hover"
      hover-stay-time="150"
    >
      <text wx:if="{{!addingToCart}}" class="btn-text">
        {{product.stock > 0 ? 'åŠ è´­ç‰©è½¦' : 'æš‚æ— åº“å­˜'}}
      </text>
      <text wx:else class="btn-text">æ·»åŠ ä¸­...</text>
      
      <!-- åŠ è½½åŠ¨ç”» -->
      <view wx:if="{{addingToCart}}" class="loading-spinner">
        <view class="spinner"></view>
      </view>
    </button>
  </view>
</view>