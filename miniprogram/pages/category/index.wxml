<!--pages/category/index.wxml-->
<view class="category-page">
  <!-- 自定义导航栏 -->
  <navigation-bar 
    title="商品分类" 
    background="#8B4513" 
    color="#FFFFFF"
    back="{{false}}"
  />
  
  <!-- 主要内容区域 -->
  <view class="category-content" bindkeydown="onKeyboardNavigation">
    <!-- 左侧分类侧边栏 -->
    <view class="category-sidebar">
      <scroll-view 
        class="sidebar-scroll" 
        scroll-y="{{true}}"
        enhanced="{{true}}"
        show-scrollbar="{{false}}"
        refresher-enabled="{{true}}"
        refresher-triggered="{{loading}}"
        bindrefresherrefresh="onRefresherRefresh"
      >
        <!-- 加载状态 -->
        <view wx:if="{{loading && categories.length === 0}}" class="category-loading">
          <view class="loading-skeleton">
            <view class="skeleton-item" wx:for="{{[1,2,3,4,5]}}" wx:key="*this">
              <view class="skeleton-text"></view>
            </view>
          </view>
        </view>
        
        <!-- 分类列表 -->
        <view wx:else class="category-list">
          <view 
            wx:for="{{categories}}" 
            wx:key="id"
            class="category-item {{selectedCategoryId === item.id ? 'active' : ''}}" 
            bindtap="onCategoryTap"
            bindlongpress="onCategoryLongPress"
            data-category-id="{{item.id}}"
            aria-label="分类：{{item.name}}，共{{item.productCount}}个商品"
            role="button"
            tabindex="0"
          >
            <text class="category-name">{{item.name}}</text>
            <text wx:if="{{item.productCount > 0}}" class="product-count">({{item.productCount}})</text>
          </view>
          
          <!-- 空状态 -->
          <view wx:if="{{categories.length === 0 && !loading}}" class="category-empty">
            <text class="empty-text">暂无分类</text>
            <text class="empty-hint">下拉刷新重试</text>
            <button class="retry-btn" bindtap="refreshCategories" size="mini">
              重新加载
            </button>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- 右侧产品列表区域 -->
    <view class="product-area">
      <scroll-view 
        class="product-scroll" 
        scroll-y="{{true}}"
        enhanced="{{true}}"
        show-scrollbar="{{false}}"
        refresher-enabled="{{true}}"
        refresher-triggered="{{productLoading}}"
        bindrefresherrefresh="onProductRefresherRefresh"
      >
        <view class="product-list">
          <!-- 产品加载状态 -->
          <view wx:if="{{productLoading && products.length === 0}}" class="product-loading">
            <view class="loading-skeleton">
              <view class="skeleton-product-card" wx:for="{{[1,2,3,4]}}" wx:key="*this">
                <view class="skeleton-image"></view>
                <view class="skeleton-content">
                  <view class="skeleton-title"></view>
                  <view class="skeleton-price"></view>
                  <view class="skeleton-button"></view>
                </view>
              </view>
            </view>
          </view>
          
          <!-- 产品列表 -->
          <view wx:elif="{{products.length > 0}}" class="products-container">
            <product-card 
              wx:for="{{products}}" 
              wx:key="id"
              product="{{item}}"
              bindproducttap="onProductTap"
              bindaddtocart="onAddToCart"
              bindlongpress="onProductLongPress"
            />
          </view>
          
          <!-- 空状态 -->
          <view wx:else class="product-empty">
            <view class="empty-icon">🛍️</view>
            <text class="empty-title">暂无商品</text>
            <text class="empty-subtitle">该分类下暂时没有商品</text>
            <text class="empty-hint">试试其他分类吧</text>
            <button class="retry-btn" bindtap="refreshProducts" size="mini">
              刷新商品
            </button>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>